{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
    <h2>Dashboard</h2>

    <!-- Summary Section -->
    <article>
    <h3>Summary</h3>
    <div class="grid">
        <div>Income: <strong style="color: green;">{{ summary.total_income | round(2) }}</strong></div>
        <div>Expenses: <strong style="color: red;">{{ summary.total_expense | round(2) }}</strong></div>
        <div>Balance: <strong>{{ summary.balance | round(2) }}</strong></div>
    </div>
    </article>

    <!-- Add Transaction Forms -->
    <section>
        <h3>Add New Transaction</h3>
        <div class="grid">
            <article>
                <h4><ins>Add Income</ins></h4>
                <form method="POST" action="{{ url_for('add_transaction') }}">
                    <input type="hidden" name="type" value="income">
                    <label for="income_amount">Amount *</label>
                    <input type="number" step="0.01" min="0.01" id="income_amount" name="amount" placeholder="e.g., 1500.00" required>
                    <label for="income_description">Description</label>
                    <input type="text" id="income_description" name="description" placeholder="e.g., Salary">
                     <label for="income_date">Date (DD-MM-YYYY)</label>
                    <input type="date" id="income_date" name="date" placeholder="Default: Today" pattern="\\d{2}-\\d{2}-\\d{4}">
                    <button type="submit">Add Income</button>
                </form>
            </article>

            <article>
                 <h4><ins>Add Expense</ins></h4>
                <form method="POST" action="{{ url_for('add_transaction') }}">
                    <input type="hidden" name="type" value="expense">
                    <label for="expense_amount">Amount *</label>
                    <input type="number" step="0.01" min="0.01" id="expense_amount" name="amount" placeholder="e.g., 55.50" required>

                    <label for="expense_category">Category *</label>
                    <input list="expense_categories" id="expense_category" name="category" placeholder="e.g., Groceries" required>
                    <datalist id="expense_categories">
                        {% for cat in categories %}
                            <option value="{{ cat }}">
                        {% endfor %}
                         <option value="Food">
                         <option value="Utilities">
                         <option value="Transport">
                         <option value="Entertainment">
                         <option value="Shopping">
                         <option value="Health">
                         <option value="Other">
                    </datalist>

                    <label for="expense_description">Description</label>
                    <input type="text" id="expense_description" name="description" placeholder="e.g., Weekly groceries">
                    <label for="expense_date">Date (DD-MM-YYYY)</label>
                    <input type="date" id="expense_date" name="date" placeholder="Default: Today" pattern="\\d{2}-\\d{2}-\\d{4}">
                    <button type="submit">Add Expense</button>
                </form>
            </article>
        </div>
    </section>

     <!-- Recommendations -->
    {% if recommendations %}
    <article>
        <h3>Recommendations</h3>
        <ul>
            {% for tip in recommendations %}
                <li>{{ tip }}</li>
            {% endfor %}
        </ul>
    </article>
    {% endif %}


    <!-- Recent Transactions Table -->
    <article>
    <h3>Recent Transactions (Last 20)</h3>
    {% if transactions %}
        <figure>
        <table role="grid">
        <thead>
            <tr>
            <th scope="col">Date</th>
            <th scope="col">Type</th>
            <th scope="col">Amount</th>
            <th scope="col">Category</th>
            <th scope="col">Description</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.date | default('N/A') }}</td>
                <td>{{ transaction.type | capitalize }}</td>
                <td class="{{ transaction.type }}"> <!-- Apply income/expense class -->
                    {{ transaction.amount | round(2) }}
                </td>
                <td>{{ transaction.category | default('') }}</td>
                <td>{{ transaction.description | default('') }}</td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
        </figure>
    {% else %}
        <p>No transactions recorded yet.</p>
    {% endif %}
    </article>

    <!-- Category Breakdown (Optional Simple Table) -->
    {% if category_summary %}
    <article>
        <h3>Spending by Category</h3>
         <figure>
        <table role="grid">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Total Spent</th>
                </tr>
            </thead>
            <tbody>
                {% for category, total in category_summary.items() | sort %}
                <tr>
                    <td>{{ category }}</td>
                    <td>{{ total | round(2) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </figure>
    </article>
    {% endif %}

{% endblock %}