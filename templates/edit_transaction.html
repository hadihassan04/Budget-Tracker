{% extends "base.html" %}
{% block title %}Edit Transaction{% endblock %}

{% block content %}
<article style="max-width: 500px; margin: 2rem auto;">
    <h2 style="margin-bottom: 1.5rem; text-align: center;">Edit Transaction</h2>
    <form method="POST" action="{{ url_for('edit_transaction', transaction_id=transaction.transaction_id) }}">
        <div style="display: flex; gap: 1.5rem; align-items: center; margin-bottom: 1rem;">
            <label for="type" style="margin-bottom: 0;">Type *</label>
            <select id="type" name="type" required style="flex: 1 1 120px; min-width: 120px;">
                <option value="income" {% if transaction.type == 'income' %}selected{% endif %}>Income</option>
                <option value="expense" {% if transaction.type == 'expense' %}selected{% endif %}>Expense</option>
            </select>
        </div>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div style="flex: 1 1 180px; min-width: 180px;">
                <label for="amount">Amount *</label>
                <input type="number" step="0.01" min="0.01" id="amount" name="amount" value="{{ transaction.amount }}" required>
            </div>
            <div style="flex: 1 1 180px; min-width: 180px;" id="category_field">
                <label id="category_label" for="category">Category *</label>
                <input list="edit_income_categories" id="category" name="category" value="{{ transaction.category | default('') }}">
                <datalist id="edit_income_categories">
                    <option value="Salary">
                    <option value="Bonus">
                    <option value="Other">
                </datalist>
                <datalist id="edit_expense_categories">
                    {% for cat in categories %}
                        <option value="{{ cat }}">
                    {% endfor %}
                    <option value="Food">
                    <option value="Utilities">
                    <option value="Transport">
                    <option value="Entertainment">
                    <option value="Shopping">
                    <option value="Health">
                    <option value="Other">
                </datalist>
            </div>
            <div style="flex: 2 1 220px; min-width: 220px;">
                <label for="description">Description</label>
                <input type="text" id="description" name="description" value="{{ transaction.description | default('') }}">
            </div>
            <div style="flex: 1 1 180px; min-width: 180px;">
                <label for="date">Date (YYYY-MM-DD)</label>
                <input type="date" id="date" name="date" value="{{ transaction.date_for_input }}">
            </div>
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button type="submit" style="flex: 1 1 120px;">Update Transaction</button>
            <a href="{{ url_for('dashboard') }}" role="button" class="secondary outline" style="flex: 1 1 120px; text-align: center;">Cancel</a>
        </div>
    </form>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function updateCategoryField() {
            var type = document.getElementById('type').value;
            var categoryInput = document.getElementById('category');
            var label = document.getElementById('category_label');
            if (type === 'income') {
                categoryInput.setAttribute('list', 'edit_income_categories');
                categoryInput.placeholder = 'e.g., Salary';
                label.textContent = 'Category * (Income)';
                categoryInput.disabled = false;
                categoryInput.required = true;
            } else {
                categoryInput.setAttribute('list', 'edit_expense_categories');
                categoryInput.placeholder = 'e.g., Groceries';
                label.textContent = 'Category * (Expense)';
                categoryInput.disabled = false;
                categoryInput.required = true;
            }
        }
        document.getElementById('type').addEventListener('change', updateCategoryField);
        updateCategoryField();
    });
    </script>
</article>
{% endblock %}